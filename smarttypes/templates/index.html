<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:py="http://genshi.edgewall.org/"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    lang="en">

<xi:include href="master.html" />      

<head>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"></script>

    <style type="text/css" media="screen">
        #map { height: 400px; }
        .leaflet-container { background:None; }
        .leaflet-popup-content {font:inherit;}
        .leaflet-container a {color: #606;}
    </style>

    <script type="text/javascript">
        $(function(){
            var reduction_id = ${reduction_id if reduction_id else 'undefined'};
            init_social_map(reduction_id);
        });
    </script>

</head>                    

<body>

    <!-- don't do anything if we don't have a reduction_id -->
    <div py:if="reduction_id" class="row-fluid" style="">
        <?python 
            communities = reduction.communities()
            root_user = reduction.root_user()
        ?>

        <div class="span8">
            <div>
                <div id="map_header">
                    <div style="float:left;width:60%;">
                        <h2>
                            <img width="50px" py:if="root_user.profile_image_url" 
                                src="${root_user.profile_image_url}" alt="root_user.screen_name" />
                            <a target="_blank" href="https://twitter.com/${root_user.screen_name}">
                                ${root_user.screen_name}</a>
                        </h2>
                        <span style="font-style:italic;">
                            ${root_user.location_name if root_user.location_name else 'No location given'}
                        </span>
                        <span py:if="root_user.description">
                            -- 
                            ${root_user.description[:80]}${'...' if len(root_user.description) &gt; 80 else ''}
                        </span>
                    </div>
                    <div style="float:right;">
                        <h3 style="padding:10px 20px 0 0;">${len(communities)} communities</h3>
                    </div>
                    <div style="clear:both;">&nbsp;</div>
                </div><!-- map_header -->

                <div id="map"></div>
            </div>
        </div>

        <div class="span4">

            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#this_map" data-toggle="tab">This map</a>
                </li>
                <li>
                    <a href="#all_maps" data-toggle="tab">Other maps</a>
                </li>
            </ul>

            <div class="tab-content">

                <div style="height:400px;overflow:scroll;" class="tab-pane active" id="this_map">
                    <ul style="list-style:none;margin:0 10px;">
                        <li py:for="community in communities" style="margin:20px auto 50px auto;">
                            <?python top_user = community.top_users(1)[0][1] ?>

                            <h3>
                                <a id="community_${community.id}" 
                                    href="#">${len(community.member_ids)} member community</a>
                            </h3>
                            
                            <b>Leader:</b>
                            
                            <div style="padding:5px 0 0 10px;">
                                <img width="50px" py:if="top_user.profile_image_url" 
                                        src="${top_user.profile_image_url}" alt="top_user.screen_name" />

                                <span style="font-weight:bold;">
                                    ${top_user.screen_name}
                                </span>

                                <span style="font-style:italic;">
                                    <br/>
                                    ${top_user.location_name if top_user.location_name else 'No location given'}
                                </span>

                                <span py:if="top_user.description">
                                    <br/>
                                    ${top_user.description[:80]}${'...' if len(top_user.description) &gt; 80 else ''}
                                </span>
                            </div>
                        </li>
                    </ul>
                </div><!-- this_map -->

                <div style="height:400px;overflow:scroll;" class="tab-pane" id="all_maps">
                    <ul style="list-style:none;margin:0 10px;">
                        <li py:if="user.id != root_user.id" style="margin:20px auto 50px auto;" 
                            py:for="user, count in user_reduction_counts">

                            <a py:if="user.profile_image_url" href="/${user.screen_name}">
                                <img width="50px" py:if="user.profile_image_url" 
                                    src="${user.profile_image_url}" alt="user.screen_name" />
                            </a>

                            <span style="font-weight:bold;">
                                <a href="/${user.screen_name}">${user.screen_name}</a>
                            </span>

                            <span style="font-style:italic;">
                                <br/>
                                ${user.location_name if user.location_name else 'No location given'}
                            </span>

                            <span py:if="user.description">
                                <br/>
                                ${user.description[:80]}${'...' if len(user.description) &gt; 80 else ''}
                            </span>
                        </li>
                    </ul>
                </div><!-- all_maps -->
            </div><!-- tab-content -->
        </div><!-- span4 -->
    </div><!-- row-fluid -->



</body>                                     
</html>

